---
title: 'Git #12 版本日誌'
date: 2016-12-29 01:37:03
tags: 
    - Git
    - Learn-Git-in-30-days
categories:
    - Git
---
### 概述
在 Git 中做的所有版本變更，即使是復原的操作，都會被記錄下來，所以透過版本日誌的紀錄，能夠還原到任何狀態。簡言之，版本日誌就是參照變更的歷程記錄。無論對這些紀錄本身做任何操作，如修改或刪除，都不會影響物件儲存庫的內容。

<!-- more -->

### 產生 Reflog 的原則
只要透過指令修改參照的內容，或是變更分支的 HEAD 參照內容，就會建立 Reflog。因為修改 ref 而產生 log，所以指令名稱才稱為 reflog。


### 產生 Reflog 的動作
除以下動作外，每個分支、暫存版都會有自己的 Reflog，這些資料也都會存在 ***.git/logs/refs/*** 資料夾下。
- Commit
- Checkout
- Pull
- Push
- Merge
- Reset
- Clone
- Branch
- Rebase
- Stash


### Reflog 的過期時間
預設保存 90 天。若其中的 Commit 物件已不在分支上，則預設保留 30 天。


### Command
 - `git reflog`
    - 列出 reflog 清單
    - `git reflog [Branch]`
        - 只顯示特定分支的 reflog
 - `git log -g`
    - 列出每個 reflog 中的內容
 - `git reflog delete [Ref@{Specifier}]`
    - 刪除特定 reflog
 - `git config --global/local gc.reflogExpire "Day"`
 - `git config --global/local gc.reflogExpireUnreachable "Day"`
    - 調整 reflog 過期的預設值
    - Day 可設定 [Number days]，如 30 days 可保留 30 天
    - Day 可設定 never 表示永不刪除紀錄
    - `git config --local gc.[Branch].reflogExpire "Day"`
    - `git config --local gc.[Branch].reflogExpireUnreachable "Day"`
        - 針對特定分支設定 reflog 過期時間
 - `git reflog expire --expire=now --all`
    -  清除所有 reflog